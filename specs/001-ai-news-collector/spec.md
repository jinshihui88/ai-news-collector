# Feature Specification: AI 新闻采集器

**Feature Branch**: `001-ai-news-collector`
**Created**: 2025-11-01
**Status**: Draft
**Input**: 用户描述: "轻量级 AI 新闻采集器 - Node.js 服务,通过配置文件管理数据源和样例,使用 LLM 智能过滤"

## Clarifications

### Session 2025-11-01

- Q: 配置文件中的样例应该包含什么内容? → A: 新闻标题+简短摘要(100-200字)
- Q: 每个数据源应该采集多少条新闻? → A: 固定数量,每个数据源采集最近10条新闻
- Q: LLM 过滤时,"高分内容"的评分阈值应该如何确定? → A: 动态阈值,根据本次采集的评分分布,保留得分最高的10-30%新闻
- Q: 当 LLM API 调用失败时,系统应该如何处理? → A: 跳过评分失败的新闻,继续处理其他新闻,在日志中记录失败的条目
- Q: 当用户没有提供任何样例时,系统应该如何处理? → A: 必须提供样例:启动时检查配置,如果样例为空则提示错误并退出
- Q: 数据源如何配置? → A: 数据源在代码中硬编码(AIbase、推特、知识星球、飞书文档、公众号),无需用户配置
- Q: 过滤结果以什么格式输出? → A: 输出为 Markdown 文档

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 配置过滤偏好样例 (Priority: P1)

作为用户,我希望通过编辑本地配置文件来设置过滤偏好样例,这样系统可以理解我的内容偏好进行智能过滤。

**Why this priority**: 样例是 LLM 理解用户偏好的核心依据,必须先配置样例才能实现智能过滤。

**Independent Test**: 可以通过编辑配置文件添加几个正反面样例,验证系统是否能正确读取配置。

**Acceptance Scenarios**:

1. **Given** 用户打开配置文件, **When** 添加正面样例(有价值的新闻标题+摘要), **Then** 系统读取并记录该样例作为高质量内容参考
2. **Given** 用户在配置文件中添加反面样例(低价值的新闻标题+摘要), **When** 系统读取配置, **Then** 系统记录该样例作为需要过滤的内容类型
3. **Given** 配置文件中没有任何样例, **When** 启动系统, **Then** 系统提示错误并退出

---

### User Story 2 - 执行采集和 LLM 智能过滤 (Priority: P1)

作为用户,我希望运行 Node.js 服务后,系统能自动从配置的数据源采集新闻,并使用 LLM 根据我提供的样例分析偏好进行过滤,最后输出过滤结果。

**Why this priority**: 这是核心价值功能,将采集、LLM 分析和过滤整合在一起,直接解决用户的信息过载问题。

**Independent Test**: 可以通过配置一个数据源和几个正反面样例,运行服务,验证是否能采集新闻并输出过滤后的结果。

**Acceptance Scenarios**:

1. **Given** 配置文件包含样例, **When** 用户运行 Node.js 服务, **Then** 系统从硬编码的数据源(AIbase等)采集最新新闻
2. **Given** 系统已采集到新闻, **When** 执行 LLM 过滤, **Then** LLM 分析用户提供的正反面样例,理解用户偏好
3. **Given** LLM 已分析用户偏好, **When** 对采集的新闻进行评分, **Then** 系统输出高分新闻列表(符合用户偏好的内容)
4. **Given** 过滤完成, **When** 用户查看输出, **Then** 系统生成 Markdown 文档,包含过滤后的新闻标题、摘要和评分理由

---

### User Story 3 - 查看采集和过滤日志 (Priority: P2)

作为用户,我希望在服务运行时能看到详细的日志输出,了解采集进度、LLM 分析过程和过滤结果,这样我可以监控系统运行状态。

**Why this priority**: 提供透明度和可调试性,但不影响核心功能运作。

**Independent Test**: 可以通过运行服务并观察控制台输出,验证是否有清晰的日志信息。

**Acceptance Scenarios**:

1. **Given** 服务开始运行, **When** 读取配置文件, **Then** 控制台输出加载的数据源数量和样例数量
2. **Given** 正在采集数据, **When** 访问各个数据源, **Then** 控制台输出每个数据源的采集进度和结果数量
3. **Given** LLM 正在分析, **When** 处理用户样例, **Then** 控制台输出 LLM 理解的用户偏好摘要
4. **Given** 过滤完成, **When** 输出结果, **Then** 控制台显示过滤统计信息(总采集数、过滤后数量、过滤率)

---

### Edge Cases

- 当配置文件格式错误时,系统是否能给出清晰的错误提示?
- 当某个数据源无法访问时,系统是否继续处理其他数据源?
- 当 LLM API 调用失败或超时时,跳过该条新闻,记录错误日志,继续处理其他新闻
- 当用户没有提供任何样例时,系统在启动时验证配置并提示错误后退出
- 当采集到的新闻数量为 0 时,系统如何反馈给用户?
- 当配置文件中的数据源 URL 无效时,系统如何处理?

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须作为 Node.js 命令行服务运行,无需前端界面
- **FR-002**: 系统必须从本地配置文件读取过滤样例
- **FR-003**: 配置文件必须支持定义正面样例和反面样例,每个样例包含新闻标题和简短摘要(100-200字)
- **FR-004**: 系统必须在代码中硬编码5个数据源:AIbase(https://www.aibase.com/zh)、推特、知识星球、飞书文档、公众号
- **FR-005**: 系统必须能够从硬编码的数据源采集最新的 AI 相关新闻内容,每个数据源采集最近10条新闻
- **FR-006**: 系统必须调用 LLM API,将用户的正反面样例发送给 LLM 以分析用户偏好
- **FR-007**: 系统必须使用 LLM 对采集到的每条新闻进行评分,判断是否符合用户偏好
- **FR-008**: 系统必须根据 LLM 评分结果过滤新闻,使用动态阈值保留得分最高的10-30%新闻
- **FR-009**: 系统必须将过滤后的新闻输出为 Markdown 文档,包括标题、摘要、来源和评分理由
- **FR-010**: 系统必须在运行过程中输出详细日志,包括配置加载、采集进度、LLM 分析和过滤结果
- **FR-011**: 系统必须处理采集错误,当某个数据源失败时继续处理其他数据源
- **FR-012**: 系统必须在配置文件格式错误时给出清晰的错误提示并退出
- **FR-014**: 系统必须在启动时验证配置文件至少包含一个正面样例和一个反面样例,如果样例为空则提示错误并退出
- **FR-013**: 系统不需要持久化存储任何数据,每次运行都是独立的

### Non-Functional Requirements

- **NFR-001**: 系统必须在 LLM API 可用的情况下,完成一次完整采集和过滤流程
- **NFR-002**: 系统必须提供清晰的控制台日志输出,便于用户了解运行状态
- **NFR-003**: 配置文件必须使用简单易读的格式(如 JSON)
- **NFR-004**: 系统必须妥善处理 LLM API 调用失败的情况,跳过评分失败的新闻并继续处理,在日志中记录失败条目和错误原因

### Key Entities

- **Config(配置)**: 代表本地配置文件的内容,包含样例列表(正面样例、反面样例),每个样例包含标题和摘要字段
- **DataSource(数据源)**: 代码中硬编码的新闻来源,包括AIbase、推特、知识星球、飞书文档、公众号
- **NewsItem(新闻条目)**: 代表单条采集的新闻,包含标题、内容摘要、来源、URL 等属性,不需要持久化
- **FilterResult(过滤结果)**: 代表 LLM 对单条新闻的评估结果,包含评分、是否通过过滤、评分理由等属性

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户能够在 2 分钟内完成配置文件的编辑(添加数据源和样例)
- **SC-002**: 系统从启动到输出过滤结果的整个流程在 5 分钟内完成(基于每个数据源采集10条新闻)
- **SC-003**: 用户运行一次命令后,系统自动完成采集、LLM 分析和过滤,无需额外操作
- **SC-004**: 过滤后的新闻数量控制在采集总量的 10-30%,确保信息密度
- **SC-005**: 基于用户样例的 LLM 过滤准确率达到 70% 以上(用户认为过滤后的内容符合预期)
- **SC-006**: 控制台日志输出清晰易读,用户能在 30 秒内理解系统运行状态
- **SC-007**: 配置文件格式简单,新用户在没有文档的情况下能在 5 分钟内理解并修改
- **SC-008**: 当单个数据源失败时,系统继续运行并成功处理其他数据源
