<!--
SYNC IMPACT REPORT
==================
Version: 1.0.0 (Initial constitution)
Date: 2025-11-01
Change Type: MINOR - Initial creation of project constitution

Modified Principles: N/A (Initial version)
Added Sections:
  - Core Principles (5 principles)
  - Technical Constraints
  - Quality Standards
  - Governance

Removed Sections: N/A

Templates Status:
  ✅ .specify/templates/plan-template.md - Reviewed, aligned with principles
  ✅ .specify/templates/spec-template.md - Reviewed, aligned with principles
  ✅ .specify/templates/tasks-template.md - Reviewed, aligned with principles

Follow-up TODOs: None
-->

# AI 新闻智能采集与过滤系统 - 项目宪章

## 核心原则

### I. 数据源统一性 (非协商)
**规则**:
- 每个配置项必须只在一个位置声明和维护
- 所有环境变量必须在 `.env` 文件中集中管理,不得分散在多个配置文件中
- 数据采集器配置必须统一在 `src/config/` 目录下
- 过滤规则配置必须集中在单一配置文件中 (`config/filter-rules.json`)
- 禁止在代码中硬编码配置值

**理由**: 防止配置不一致导致的维护困难和潜在bug。多个配置源会导致不同环境下行为差异,增加调试难度。

### II. 模块化与可扩展性
**规则**:
- 每个数据源采集器必须实现统一的 `Collector` 接口
- 所有采集器必须返回标准化的 `NewsItem` 数据结构
- 新增数据源不得修改现有采集器代码
- 过滤器必须可插拔,支持独立测试和替换
- 输出推送模块必须实现统一的 `Publisher` 接口

**理由**: 便于添加新的数据源和输出渠道,降低维护成本,提高代码复用性。

### III. 错误处理与容错性 (非协商)
**规则**:
- 单个数据源失败不得导致整个工作流中断
- 必须实现重试机制,最多重试3次,使用指数退避策略
- 所有外部API调用必须设置超时时间(默认30秒)
- 关键失败(如LLM服务不可用)必须通过告警通知用户

**理由**: 数据采集涉及多个不稳定的外部服务,必须保证系统稳定性和可观测性。

### IV. 成本控制与性能优化
**规则**:
- LLM API调用必须经过关键词初筛,减少至少80%的数据量
- 支持批量处理以降低API调用次数
- 实现基于URL的去重缓存,避免重复评分
- 全流程执行时间不得超过5分钟
- 必须并行执行独立的数据采集任务

**理由**: 控制运营成本,确保系统可持续运行。提高执行效率,减少用户等待时间。

### V. 数据质量保证
**规则**:
- 过滤后的新闻必须经过去重处理,准确率≥95%
- 推送的新闻评分阈值不得低于6分(10分制)
- 必须保留原始数据以支持后续审计和分析
- 标题、URL、发布时间为必填字段,缺失则丢弃该条新闻
- 每日推送数量控制在10-20条,确保信息密度

**理由**: 保证推送给用户的信息质量,避免垃圾信息干扰。支持数据追溯和质量改进。

## 技术约束

### 技术栈要求
- **运行时**: Node.js 18+ (LTS版本)
- **包管理**: npm (保持package.json为唯一依赖声明文件)
- **核心依赖**:
  - `@composio/sdk` - 多平台集成
  - `dotenv` - 环境变量管理
  - `axios` - HTTP请求
  - `cheerio` - HTML解析
  - 可选: `puppeteer` (浏览器自动化)

### 代码规范
- 使用 ES6+ 模块语法 (`import/export`)
- 异步操作必须使用 `async/await`
- 错误处理必须使用 `try-catch`
- 函数命名采用驼峰命名法 (`camelCase`)
- 常量使用大写下划线命名 (`UPPER_SNAKE_CASE`)
- 必须包含 JSDoc 注释(接口和公共函数)

## 质量标准

### 功能验收标准
- 必须成功从至少2个数据源采集数据(Twitter、AIBase优先)
- 关键词过滤准确率 > 90%
- 去重率 > 95%
- 定时任务稳定运行7天无中断

### 性能标准
- 全流程执行时间 < 5分钟
- 内存占用 < 512MB
- 支持至少50条新闻的并行处理

### 安全标准
- API密钥必须通过环境变量管理,不得硬编码
- `.env` 文件必须在 `.gitignore` 中排除
- 外部API调用必须验证响应数据结构
- 用户输入(如配置文件)必须经过验证和清理

### 可维护性标准
- 新增数据源不得修改超过2个现有文件
- 修改过滤规则只需更新配置文件,无需改动代码
- 关键逻辑必须有注释说明
- README必须包含快速开始指南
- 环境变量必须在 `.env.example` 中有说明

## 治理规则

### 宪章优先级
本宪章规则优先于所有其他开发实践和个人偏好。任何代码提交、功能开发、架构决策都必须符合本宪章的核心原则。

### 修订流程
1. **提出修订**: 在项目issue中说明修订理由和影响范围
2. **影响评估**: 评估对现有代码、依赖模板、开发流程的影响
3. **版本升级**: 根据语义化版本规则更新版本号
   - MAJOR: 删除或重新定义核心原则(破坏性变更)
   - MINOR: 新增原则或章节(向后兼容)
   - PATCH: 澄清措辞、修正错误(无语义变更)
4. **模板同步**: 更新所有受影响的模板文件(plan、spec、tasks)
5. **文档更新**: 在宪章顶部添加同步影响报告

### 合规审查
- 每个PR必须自检是否符合本宪章的核心原则
- 违反"非协商"原则的PR必须被拒绝
- 复杂度增加必须在PR中明确说明理由和替代方案
- 定期(每月)审查宪章的适用性,根据项目发展调整

### 开发指导
- 开发过程中遇到决策困难时,优先参考本宪章的核心原则
- 新功能必须在 `specs/` 目录下创建规格说明和实现计划
- 使用 `/speckit.*` 命令生成和管理开发文档
- 遵循宪章中定义的项目结构和代码规范

**版本**: 1.0.0 | **批准日期**: 2025-11-01 | **最后修订**: 2025-11-01
